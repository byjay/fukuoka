<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Guide | World Builder</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="./styles/hybrid.css">
    <style>
        .filter-bar {
            position: sticky;
            top: 70px;
            /* Below nav */
            background: rgba(13, 13, 13, 0.95);
            padding: 15px 0;
            z-index: 90;
            border-bottom: 1px solid var(--glass-border);
            text-align: center;
        }

        .filter-btn {
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--text-color);
            padding: 8px 16px;
            border-radius: 20px;
            margin: 0 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: var(--accent-color);
            color: #000;
            border-color: var(--accent-color);
        }
    </style>
</head>

<body>

    <!-- NAV -->
    <nav class="nav-bar">
        <div class="logo"><a href="index.html">WORLD BUILDER</a></div>
        <div class="nav-links">
            <a href="index.html" class="nav-item">Home</a>
            <a href="#" onclick="alert('Booking feature coming soon!'); return false;" class="nav-item"
                style="color: var(--accent-color)">Book Trip</a>
        </div>
    </nav>

    <!-- HERO -->
    <section class="hero" style="height: 60vh;">
        <img id="hero-bg" src=""
            style="position: absolute; width: 100%; height: 100%; object-fit: cover; opacity: 0.5; z-index: -1;">
        <div class="hero-content">
            <div class="serif" style="color: var(--accent-color); margin-bottom: 15px;">The Curated Guide to</div>
            <h1 class="hero-title" id="city-title">Loading...</h1>
            <p class="hero-subtitle" id="city-subtitle">Discovering hidden gems and local favorites</p>
        </div>
    </section>

    <!-- FILTER -->
    <div class="filter-bar">
        <button class="filter-btn active" onclick="filterPlaces('all')">All</button>
        <button class="filter-btn" onclick="filterPlaces('맛집')">Restaurants</button>
        <button class="filter-btn" onclick="filterPlaces('카페')">Cafes</button>
        <button class="filter-btn" onclick="filterPlaces('관광')">Sightseeing</button>
        <button class="filter-btn" onclick="filterPlaces('쇼핑')">Shopping</button>
    </div>

    <!-- CONTENT -->
    <section class="container">
        <!-- Native Ad Top -->
        <div id="ad-top"></div>

        <div class="grid" id="content-grid">
            <!-- Loading State -->
            <div style="grid-column: 1/-1; text-align: center; padding: 50px;">
                <div class="serif" style="font-size: 1.5rem; color: var(--accent-color);">Loading Data...</div>
            </div>
        </div>

        <!-- Native Ad Bottom -->
        <div id="ad-bottom"></div>
    </section>

    <footer>
        <p>&copy; 2025 World Builder. <a href="#">Become a Partner</a></p>
    </footer>

    <!-- SCRIPTS -->
    <script src="./scripts/ui_core.js"></script>
    <script>
        const cityCode = HybridUI.getUrlParam('city');
        const cityName = HybridUI.getUrlParam('name') || cityCode;
        let allPlaceData = [];

        // Setup Page
        document.getElementById('city-title').innerText = decodeURIComponent(cityName);
        const heroBg = document.getElementById('hero-bg');
        // Unsplash Source helps with dynamic vibe
        heroBg.src = `https://source.unsplash.com/1600x900/?${cityCode},travel,landmark`;

        // Load Data
        if (cityCode) {
            HybridUI.loadCityData(cityCode)
                .then(data => {
                    allPlaceData = data;
                    renderGrid(data);

                    // Inject Ads
                    document.getElementById('ad-top').innerHTML = HybridUI.renderAdCard('hotel');
                })
                .catch(err => {
                    document.getElementById('content-grid').innerHTML = `
                        <div style="grid-column: 1/-1; text-align: center;">
                            <h3>Data Not Found</h3>
                            <p>We are still collecting data for this city. Please try running the generator.</p>
                            <code style="display:block; margin-top:10px; opacity:0.6">${err.message}</code>
                        </div>
                    `;
                });
        }

        // Filtering Logic
        window.filterPlaces = (type) => {
            // Update buttons
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (type === 'all') {
                renderGrid(allPlaceData);
            } else {
                const filtered = allPlaceData.filter(p => p.type.includes(type));
                renderGrid(filtered);
            }
        };

        function renderGrid(data) {
            const grid = document.getElementById('content-grid');
            grid.innerHTML = '';

            if (data.length === 0) {
                grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">No places found for this category.</p>';
                return;
            }

            data.forEach((place, index) => {
                grid.innerHTML += HybridUI.renderPlaceCard(place);

                // Inject contextual ad every 12 items
                if ((index + 1) % 12 === 0) {
                    // Create a full-width ad span or just insert a distinct card
                    // For grid layout, we can just insert a card with distinct styling
                    // But simpler to just inject it as a node (HTML string concatenation handles it)
                    grid.innerHTML += `
                        <div class="card" style="background: linear-gradient(135deg, #d4af37 0%, #000 100%); border:none; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; padding:20px;">
                             <h3 class="serif" style="color:#fff; margin-bottom:10px;">Travel Smart</h3>
                             <p style="color:#fff; margin-bottom:15px; font-size:0.9rem;">Get 5% off travel insurance.</p>
                             <button style="background:#fff; color:#000; padding:8px 16px; border:none; border-radius:4px; font-weight:bold; cursor:pointer;">Learn More</button>
                        </div>
                     `;
                }
            });
        }
    </script>
</body>

</html>